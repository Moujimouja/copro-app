You are an AI assistant helping to build a web application called "copro-app" for managing a single condominium residence.
The goal of copro-app is to help manage condominium residence operations, including:
- Login and user authentication (admin only for now, future: residents, syndic, council, maintenance)
- Admin interface for managing equipment (ServiceInstance), buildings, users, and their status
- Public incident/request reporting form (tickets) with type selection (Incident or Request)
- Status Page (similar to CachetHQ): show services of the residence (ex: elevators, doors, parking gates, heating) + uptime, incidents, scheduled maintenance
- Ticket management: public can create tickets, admin reviews with workflow (analyzing â†’ in_progress â†’ resolved â†’ closed), can add comments, and can convert tickets to incidents
- Incident management: admin can create, edit (title, description, equipment), update status, and add comments/updates
- Maintenance management: scheduled maintenances with start/end dates and associated equipment
- Expenses tracking: visualization of copropriÃ©tÃ© expenses
- Dashboard and analytics showing overall availability and key metrics (future)
- Notifications system (email, push) for incident updates (future)

ğŸ§± Tech stack
Backend: FastAPI (Python 3.11), PostgreSQL 15, Docker, JWT auth with bcrypt (direct, not passlib)
Frontend: React 18 + Vite (SPA), no TypeScript yet (plain JSX)
Target architecture: Docker-based (dev + prod), can run on AWS or on a Mac Freebox-exposed server
CORS configured for localhost:5173 (Vite default port)

ğŸ“Š Data Models (SQLAlchemy)
- Copro: Single copropriÃ©tÃ© (one instance = one copro) with name, address, city, postal_code, country
- Building: Buildings in the copro (A, B, 1, 2, etc.) with order for display
- ServiceInstance: Actual equipment instances in buildings with status (operational, degraded, partial_outage, major_outage, maintenance)
- Ticket: Public incident/request reports with type (INCIDENT, REQUEST) and status (analyzing, in_progress, resolved, closed)
- TicketComment: Admin comments on tickets, transferred to incidents when ticket is converted
- Incident: Official incidents created by admin with status (investigating, in_progress, resolved, closed), editable title/description/equipment
- IncidentUpdate: Status updates and messages on incidents
- IncidentComment: Admin comments on incidents
- Maintenance: Scheduled maintenances with start_date, end_date, and associated equipment
- User: Users with is_superuser flag for admin access, copro_id for association

ğŸ”‘ Authentication
- JWT-based authentication
- Admin account: email "admin@example.com", password "admin123" (created via init_test_data script)
- Only admins can access /admin routes
- Public routes: /status, /report, /expenses (no auth required)

ğŸ“ Project Structure
backend/app/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ copro.py          # Copro, Building, ServiceInstance
â”‚   â”œâ”€â”€ status.py         # Incident, IncidentUpdate, IncidentComment, ServiceStatus enums
â”‚   â”œâ”€â”€ ticket.py         # Ticket, TicketStatus, TicketType
â”‚   â”œâ”€â”€ ticket_comment.py # TicketComment
â”‚   â”œâ”€â”€ maintenance.py    # Maintenance
â”‚   â””â”€â”€ user.py           # User (with copro_id, is_superuser)
â”œâ”€â”€ api/endpoints/
â”‚   â”œâ”€â”€ admin.py          # Admin-only endpoints (equipment, incidents, tickets, maintenances, users)
â”‚   â”œâ”€â”€ auth.py           # Login, register
â”‚   â”œâ”€â”€ public.py         # Public endpoints (ticket creation, service list)
â”‚   â””â”€â”€ status.py         # Status page data (public)
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ init_test_data.py # Initialize test data (copro, buildings, equipment, admin user)
â”‚   â”œâ”€â”€ migrate_ticket_type.py    # Migration for ticket type column
â”‚   â””â”€â”€ migrate_ticket_status.py  # Migration for ticket status enum
â””â”€â”€ core/config.py        # Settings (CORS, DB, etc.)

frontend/src/
â”œâ”€â”€ App.jsx               # Main app with routing, sticky header with burger menu
â”œâ”€â”€ Admin.jsx             # Admin interface (equipment, tickets, incidents, maintenances, users, copro management)
â”œâ”€â”€ Status.jsx            # Public status page with modern design
â”œâ”€â”€ ReportIncident.jsx    # Public incident/request reporting form with type selection
â”œâ”€â”€ Expenses.jsx           # Expenses tracking page
â””â”€â”€ Login.jsx             # Login form (integrated in App.jsx)

ğŸ“Œ Key requirements:
- App is for ONE copropriÃ©tÃ© per instance (simplified, no multi-tenant)
- App must be modular, agnostic, and easily deployable
- Code must be clean and maintainable (DDD or modular services)
- API documented using OpenAPI (FastAPI auto-docs)
- Frontend communicates via REST API
- Mobile-friendly design (responsive with burger menu)
- Form validation with clear error messages
- Conditional field requirements (equipment optional for requests)

ğŸ¯ Ticket Workflow:
1. Public creates ticket (type: Incident or Request)
2. Status: analyzing (default) â†’ in_progress â†’ resolved â†’ closed
3. Admin can add comments at any stage
4. Admin can convert ticket to incident (comments are transferred)
5. Equipment field is required for incidents, optional for requests

ğŸ¯ Incident Management:
- Admin can create incidents directly or from tickets
- Admin can edit: title, description, equipment
- Admin can update status with validation
- Admin can add comments and updates
- Status workflow: investigating â†’ in_progress â†’ resolved â†’ closed

ğŸ¯ Status Page Features:
- Modern design with circular copropriÃ©tÃ© image
- Buildings grouped with collapsible sections
- Buildings with all services operational are collapsed by default
- Shows active incidents and maintenances
- Shows incident history

ğŸ§ª Development workflow
- Whenever I ask for code, update existing files instead of rewriting everything
- Always propose file-level changes in patch format
- Ask clarifying questions if requirements are ambiguous
- Keep long-term coherence in naming, folder structure, auth flow
- Use bcrypt directly (not passlib) for password hashing
- CORS configured for localhost:5173 (Vite default port)
- Use IncidentUpdateModel (not IncidentUpdate) for SQLAlchemy model to avoid conflict with Pydantic schema

ğŸš¨ Cursor should remember:
- Single copropriÃ©tÃ© per instance (not multi-tenant)
- Status page + incident ticketing are core features
- Admin interface for equipment management is essential
- Public ticket form with type selection (Incident/Request)
- Ticket workflow with status progression
- Admin comments on tickets and incidents
- Ticket to incident conversion with comment transfer
- Incident editing (title, description, equipment)
- Maintenance management with date ranges
- Deployment simplicity is a priority
- Use ServiceInstance (not old Service model) for equipment
- Admin routes require is_superuser = True
- Frontend port is 5173 (Vite default), not 3000
- Header is sticky with burger menu on mobile
- Buildings with all operational services are collapsed by default

ğŸ¯ What you should do when I ask:
1ï¸âƒ£ Understand context + architecture
2ï¸âƒ£ Propose incremental changes
3ï¸âƒ£ Suggest folder/content updates
4ï¸âƒ£ Give me Docker and production guidance when needed
5ï¸âƒ£ Remember: one copro per instance, admin-only management, public reporting
6ï¸âƒ£ Use IncidentUpdateModel for SQLAlchemy, IncidentUpdate for Pydantic schemas

ğŸ”§ Available Scripts
- Initialize test data: `python -m app.scripts.init_test_data` (creates copro, buildings, equipment, admin@example.com/admin123)
- Migrate ticket type: `python -m app.scripts.migrate_ticket_type`
- Migrate ticket status: `python -m app.scripts.migrate_ticket_status`

If any task is unclear, ask questions before producing code.
